import{g as le,W as pe}from"./index-Dm-vPjSz.js";const q={RECORDING:"RECORDING",PAUSED:"PAUSED",NONE:"NONE"};var V={},H,te;function ve(){if(te)return H;te=1;function S(o){return o&&o.__esModule?o:{default:o}}return H=S,H}var $={exports:{}},ne;function ge(){return ne||(ne=1,function(S){var o=function(s){var f=Object.prototype,u=f.hasOwnProperty,h=Object.defineProperty||function(r,e,t){r[e]=t.value},c,l=typeof Symbol=="function"?Symbol:{},d=l.iterator||"@@iterator",b=l.asyncIterator||"@@asyncIterator",p=l.toStringTag||"@@toStringTag";function v(r,e,t){return Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{v({},"")}catch{v=function(e,t,i){return e[t]=i}}function G(r,e,t,i){var n=e&&e.prototype instanceof k?e:k,a=Object.create(n.prototype),g=new j(i||[]);return h(a,"_invoke",{value:he(r,t,g)}),a}s.wrap=G;function N(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(i){return{type:"throw",arg:i}}}var K="suspendedStart",de="suspendedYield",Z="executing",L="completed",w={};function k(){}function A(){}function P(){}var F={};v(F,d,function(){return this});var U=Object.getPrototypeOf,C=U&&U(U(Y([])));C&&C!==f&&u.call(C,d)&&(F=C);var T=P.prototype=k.prototype=Object.create(F);A.prototype=P,h(T,"constructor",{value:P,configurable:!0}),h(P,"constructor",{value:A,configurable:!0}),A.displayName=v(P,p,"GeneratorFunction");function x(r){["next","throw","return"].forEach(function(e){v(r,e,function(t){return this._invoke(e,t)})})}s.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===A||(e.displayName||e.name)==="GeneratorFunction":!1},s.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,P):(r.__proto__=P,v(r,p,"GeneratorFunction")),r.prototype=Object.create(T),r},s.awrap=function(r){return{__await:r}};function M(r,e){function t(a,g,m,y){var R=N(r[a],r,g);if(R.type==="throw")y(R.arg);else{var W=R.arg,_=W.value;return _&&typeof _=="object"&&u.call(_,"__await")?e.resolve(_.__await).then(function(D){t("next",D,m,y)},function(D){t("throw",D,m,y)}):e.resolve(_).then(function(D){W.value=D,m(W)},function(D){return t("throw",D,m,y)})}}var i;function n(a,g){function m(){return new e(function(y,R){t(a,g,y,R)})}return i=i?i.then(m,m):m()}h(this,"_invoke",{value:n})}x(M.prototype),v(M.prototype,b,function(){return this}),s.AsyncIterator=M,s.async=function(r,e,t,i,n){n===void 0&&(n=Promise);var a=new M(G(r,e,t,i),n);return s.isGeneratorFunction(e)?a:a.next().then(function(g){return g.done?g.value:a.next()})};function he(r,e,t){var i=K;return function(a,g){if(i===Z)throw new Error("Generator is already running");if(i===L){if(a==="throw")throw g;return re()}for(t.method=a,t.arg=g;;){var m=t.delegate;if(m){var y=ee(m,t);if(y){if(y===w)continue;return y}}if(t.method==="next")t.sent=t._sent=t.arg;else if(t.method==="throw"){if(i===K)throw i=L,t.arg;t.dispatchException(t.arg)}else t.method==="return"&&t.abrupt("return",t.arg);i=Z;var R=N(r,e,t);if(R.type==="normal"){if(i=t.done?L:de,R.arg===w)continue;return{value:R.arg,done:t.done}}else R.type==="throw"&&(i=L,t.method="throw",t.arg=R.arg)}}}function ee(r,e){var t=e.method,i=r.iterator[t];if(i===c)return e.delegate=null,t==="throw"&&r.iterator.return&&(e.method="return",e.arg=c,ee(r,e),e.method==="throw")||t!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+t+"' method")),w;var n=N(i,r.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,w;var a=n.arg;if(!a)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,w;if(a.done)e[r.resultName]=a.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=c);else return a;return e.delegate=null,w}x(T),v(T,p,"Generator"),v(T,d,function(){return this}),v(T,"toString",function(){return"[object Generator]"});function fe(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function B(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function j(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(fe,this),this.reset(!0)}s.keys=function(r){var e=Object(r),t=[];for(var i in e)t.push(i);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}};function Y(r){if(r){var e=r[d];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var t=-1,i=function n(){for(;++t<r.length;)if(u.call(r,t))return n.value=r[t],n.done=!1,n;return n.value=c,n.done=!0,n};return i.next=i}}return{next:re}}s.values=Y;function re(){return{value:c,done:!0}}return j.prototype={constructor:j,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(B),!r)for(var e in this)e.charAt(0)==="t"&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function t(y,R){return a.type="throw",a.arg=r,e.next=y,R&&(e.method="next",e.arg=c),!!R}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if(n.tryLoc==="root")return t("end");if(n.tryLoc<=this.prev){var g=u.call(n,"catchLoc"),m=u.call(n,"finallyLoc");if(g&&m){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(g){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else if(m){if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&u.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&(r==="break"||r==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=r,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,w):this.complete(a)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),w},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),B(t),w}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var i=t.completion;if(i.type==="throw"){var n=i.arg;B(t)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:Y(r),resultName:e,nextLoc:t},this.method==="next"&&(this.arg=c),w}},s}(S.exports);try{regeneratorRuntime=o}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}}($)),$.exports}var Q,ie;function me(){return ie||(ie=1,Q=ge()),Q}var z,oe;function Re(){if(oe)return z;oe=1;function S(s,f,u,h,c,l,d){try{var b=s[l](d),p=b.value}catch(v){u(v);return}b.done?f(p):Promise.resolve(p).then(h,c)}function o(s){return function(){var f=this,u=arguments;return new Promise(function(h,c){var l=s.apply(f,u);function d(p){S(l,h,c,d,b,"next",p)}function b(p){S(l,h,c,d,b,"throw",p)}d(void 0)})}}return z=o,z}var ae;function ye(){return ae||(ae=1,function(S){var o=ve();Object.defineProperty(S,"__esModule",{value:!0}),S.default=u;var s=o(me()),f=o(Re());function u(c){return h.apply(this,arguments)}function h(){return(h=(0,f.default)(s.default.mark(function c(l){var d,b;return s.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return d=document.createElement("video"),b=new Promise(function(v,G){d.addEventListener("loadedmetadata",function(){d.duration===1/0?(d.currentTime=Number.MAX_SAFE_INTEGER,d.ontimeupdate=function(){d.ontimeupdate=null,v(d.duration),d.currentTime=0}):v(d.duration)}),d.onerror=function(N){return G(N.target.error)}}),d.src=typeof l=="string"||l instanceof String?l:window.URL.createObjectURL(l),p.abrupt("return",b);case 4:case"end":return p.stop()}},c)}))).apply(this,arguments)}}(V)),V}var we=ye();const Ee=le(we),O=()=>({value:!0}),I=()=>({value:!1}),Se=()=>new Error("MISSING_PERMISSION"),be=()=>new Error("ALREADY_RECORDING"),Oe=()=>new Error("DEVICE_CANNOT_VOICE_RECORD"),se=()=>new Error("FAILED_TO_RECORD"),Pe=()=>new Error("EMPTY_RECORDING"),X=()=>new Error("RECORDING_HAS_NOT_STARTED"),ue=()=>new Error("FAILED_TO_FETCH_RECORDING"),J=()=>new Error("COULD_NOT_QUERY_PERMISSION_STATUS"),De=["audio/aac","audio/webm;codecs=opus","audio/mp4","audio/webm","audio/ogg;codecs=opus"],ce=()=>new Promise(()=>{});class E{constructor(){this.mediaRecorder=null,this.chunks=[],this.pendingResult=ce()}static async canDeviceVoiceRecord(){var o;return((o=navigator==null?void 0:navigator.mediaDevices)===null||o===void 0?void 0:o.getUserMedia)==null||E.getSupportedMimeType()==null?I():O()}async startRecording(){if(this.mediaRecorder!=null)throw be();if(!(await E.canDeviceVoiceRecord()).value)throw Oe();if(!(await E.hasAudioRecordingPermission().catch(()=>O())).value)throw Se();return navigator.mediaDevices.getUserMedia({audio:!0}).then(this.onSuccessfullyStartedRecording.bind(this)).catch(this.onFailedToStartRecording.bind(this))}async stopRecording(){if(this.mediaRecorder==null)throw X();try{return this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(o=>o.stop()),this.pendingResult}catch{throw ue()}finally{this.prepareInstanceForNextOperation()}}static async hasAudioRecordingPermission(){return navigator.permissions.query==null?navigator.mediaDevices==null?Promise.reject(J()):navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>O()).catch(()=>{throw J()}):navigator.permissions.query({name:"microphone"}).then(o=>({value:o.state==="granted"})).catch(()=>{throw J()})}static async requestAudioRecordingPermission(){return(await E.hasAudioRecordingPermission().catch(()=>I())).value?O():navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>O()).catch(()=>I())}pauseRecording(){if(this.mediaRecorder==null)throw X();return this.mediaRecorder.state==="recording"?(this.mediaRecorder.pause(),Promise.resolve(O())):Promise.resolve(I())}resumeRecording(){if(this.mediaRecorder==null)throw X();return this.mediaRecorder.state==="paused"?(this.mediaRecorder.resume(),Promise.resolve(O())):Promise.resolve(I())}getCurrentStatus(){return this.mediaRecorder==null?Promise.resolve({status:q.NONE}):this.mediaRecorder.state==="recording"?Promise.resolve({status:q.RECORDING}):this.mediaRecorder.state==="paused"?Promise.resolve({status:q.PAUSED}):Promise.resolve({status:q.NONE})}static getSupportedMimeType(){if((MediaRecorder==null?void 0:MediaRecorder.isTypeSupported)==null)return null;const o=De.find(s=>MediaRecorder.isTypeSupported(s));return o??null}onSuccessfullyStartedRecording(o){return this.pendingResult=new Promise((s,f)=>{this.mediaRecorder=new MediaRecorder(o),this.mediaRecorder.onerror=()=>{this.prepareInstanceForNextOperation(),f(se())},this.mediaRecorder.onstop=async()=>{const u=E.getSupportedMimeType();if(u==null){this.prepareInstanceForNextOperation(),f(ue());return}const h=new Blob(this.chunks,{type:u});if(h.size<=0){this.prepareInstanceForNextOperation(),f(Pe());return}const c=await E.blobToBase64(h),l=await Ee(h);this.prepareInstanceForNextOperation(),s({value:{recordDataBase64:c,mimeType:u,msDuration:l*1e3}})},this.mediaRecorder.ondataavailable=u=>this.chunks.push(u.data),this.mediaRecorder.start()}),O()}onFailedToStartRecording(){throw this.prepareInstanceForNextOperation(),se()}static blobToBase64(o){return new Promise(s=>{const f=new FileReader;f.onloadend=()=>{const u=String(f.result),h=u.split("base64,"),c=h.length>1?h[1]:u;s(c.trim())},f.readAsDataURL(o)})}prepareInstanceForNextOperation(){if(this.mediaRecorder!=null&&this.mediaRecorder.state==="recording")try{this.mediaRecorder.stop()}catch(o){console.warn("While trying to stop a media recorder, an error was thrown",o)}this.pendingResult=ce(),this.mediaRecorder=null,this.chunks=[]}}class Ne extends pe{constructor(){super(...arguments),this.voiceRecorderInstance=new E}canDeviceVoiceRecord(){return E.canDeviceVoiceRecord()}hasAudioRecordingPermission(){return E.hasAudioRecordingPermission()}requestAudioRecordingPermission(){return E.requestAudioRecordingPermission()}startRecording(){return this.voiceRecorderInstance.startRecording()}stopRecording(){return this.voiceRecorderInstance.stopRecording()}pauseRecording(){return this.voiceRecorderInstance.pauseRecording()}resumeRecording(){return this.voiceRecorderInstance.resumeRecording()}getCurrentStatus(){return this.voiceRecorderInstance.getCurrentStatus()}}export{Ne as VoiceRecorderWeb};
